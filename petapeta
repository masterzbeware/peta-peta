-- ✅ Obsidian UI Setup
local repo = "https://raw.githubusercontent.com/deividcomsono/Obsidian/main/"
local Library = loadstring(game:HttpGet(repo .. "Library.lua"))()

Library.ForceCheckbox = false
Library.ShowToggleFrameInKeybinds = true

local Window = Library:CreateWindow({
    Title = "Bug Hunter",
    Footer = "by MasterZ",
    Icon = 0,
    NotifySide = "Right",
    ShowCustomCursor = true,
})

-- ✅ Tabs & GroupBox
local Tabs = {
    Main = Window:AddTab("Main", "bug"),
}
local ESPBox = Tabs.Main:AddLeftGroupbox("ESP & Coin")

-- ✅ Warna untuk tiap ESP
local highlightColors = {
    Key = Color3.fromRGB(255, 223, 0),
    OfudaBox2 = Color3.fromRGB(0, 255, 255),
    Safe = Color3.fromRGB(255, 0, 0),
}

-- ✅ Fungsi ESP
local function highlightModel(model, color)
    if not model or model:FindFirstChild("ESP_Highlight") then return end
    local hl = Instance.new("Highlight")
    hl.Name = "ESP_Highlight"
    hl.Adornee = model
    hl.FillColor = color
    hl.OutlineColor = Color3.new(1, 1, 1)
    hl.FillTransparency = 0.25
    hl.OutlineTransparency = 0
    hl.Parent = model
end

local function removeHighlight(model)
    local hl = model:FindFirstChild("ESP_Highlight")
    if hl then hl:Destroy() end
end

-- ✅ Toggle: ESP Key
ESPBox:AddToggle("ESPKey", {
    Text = "ESP Key",
    Default = false,
    Callback = function(state)
        local spawnedItems = workspace:FindFirstChild("Server") and workspace.Server:FindFirstChild("SpawnedItems")
        if not spawnedItems then return end

        for _, model in ipairs(spawnedItems:GetChildren()) do
            if model:IsA("Model") and model.Name == "Key" then
                if state then
                    highlightModel(model, highlightColors.Key)
                else
                    removeHighlight(model)
                end
            end
        end

        if not _G.ESPKeyConnection then
            _G.ESPKeyConnection = spawnedItems.ChildAdded:Connect(function(child)
                if child:IsA("Model") and child.Name == "Key" and Toggles.ESPKey.Value then
                    task.wait(0.1)
                    highlightModel(child, highlightColors.Key)
                end
            end)
        end

        if not state and _G.ESPKeyConnection then
            _G.ESPKeyConnection:Disconnect()
            _G.ESPKeyConnection = nil
        end
    end
})

-- ✅ Toggle: ESP Box
ESPBox:AddToggle("ESPBox", {
    Text = "ESP Box",
    Default = false,
    Callback = function(state)
        local spawnedItems = workspace:FindFirstChild("Server") and workspace.Server:FindFirstChild("SpawnedItems")
        if not spawnedItems then return end

        for _, model in ipairs(spawnedItems:GetChildren()) do
            if model:IsA("Model") and model.Name == "OfudaBox2" then
                if state then
                    highlightModel(model, highlightColors.OfudaBox2)
                else
                    removeHighlight(model)
                end
            end
        end

        if not _G.ESPBoxConnection then
            _G.ESPBoxConnection = spawnedItems.ChildAdded:Connect(function(child)
                if child:IsA("Model") and child.Name == "OfudaBox2" and Toggles.ESPBox.Value then
                    task.wait(0.1)
                    highlightModel(child, highlightColors.OfudaBox2)
                end
            end)
        end

        if not state and _G.ESPBoxConnection then
            _G.ESPBoxConnection:Disconnect()
            _G.ESPBoxConnection = nil
        end
    end
})

-- ✅ Toggle: ESP Safe
ESPBox:AddToggle("ESPSafe", {
    Text = "ESP Safe",
    Default = false,
    Callback = function(state)
        local roomsFolder = workspace:FindFirstChild("Client")
            and workspace.Client:FindFirstChild("Mirror")
            and workspace.Client.Mirror:FindFirstChild("Rooms")
        if not roomsFolder then return end

        for _, room in ipairs(roomsFolder:GetChildren()) do
            local props = room:FindFirstChild("Props")
            if props then
                for _, item in ipairs(props:GetChildren()) do
                    if item:IsA("Model") and item.Name == "Safe" then
                        if state then
                            highlightModel(item, highlightColors.Safe)
                        else
                            removeHighlight(item)
                        end
                    end
                end
            end
        end

        if not _G.SafeConnection then
            _G.SafeConnection = roomsFolder.ChildAdded:Connect(function(room)
                task.wait(0.2)
                if Toggles.ESPSafe.Value and room:IsA("Model") then
                    local props = room:FindFirstChild("Props")
                    if props then
                        for _, item in ipairs(props:GetChildren()) do
                            if item:IsA("Model") and item.Name == "Safe" then
                                highlightModel(item, highlightColors.Safe)
                            end
                        end
                    end
                end
            end)
        end

        if not state and _G.SafeConnection then
            _G.SafeConnection:Disconnect()
            _G.SafeConnection = nil
        end
    end
})

-- ✅ Toggle: Auto Collect Coin with Teleport (Zeni_1, Zeni_2, Zeni_3)
ESPBox:AddToggle("AutoCoin", {
    Text = "Auto Collect Coin (Teleport Zeni_1~3)",
    Default = false,
    Callback = function(state)
        if state then
            if not _G.CoinLoop then
                _G.CoinLoop = true
                task.spawn(function()
                    local player = game.Players.LocalPlayer
                    local spawnedItems = workspace:WaitForChild("Server"):WaitForChild("SpawnedItems")

                    while _G.CoinLoop and task.wait(1) do
                        for _, model in ipairs(spawnedItems:GetChildren()) do
                            if model:IsA("Model") and (model.Name == "Zeni_1" or model.Name == "Zeni_2" or model.Name == "Zeni_3") then
                                local ip = model:FindFirstChild("InteractPoint")
                                local prompt = ip and ip:FindFirstChild("ItemInteractP")
                                if prompt and prompt:IsA("ProximityPrompt") then
                                    local character = player.Character or player.CharacterAdded:Wait()
                                    if character and character:FindFirstChild("HumanoidRootPart") then
                                        character:PivotTo(model:GetPivot())
                                        task.wait(0.2)
                                        fireproximityprompt(prompt)
                                    end
                                end
                            end
                        end
                    end
                end)
            end
        else
            _G.CoinLoop = false
        end
    end
})
